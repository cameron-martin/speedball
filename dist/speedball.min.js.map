{"version":3,"file":"speedball.min.js","sources":["../.gobble-build/03-addEsModule/1/speedball.js"],"sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define('speedball', ['exports'], factory) :\n  (factory((global.Speedball = global.Speedball || {})));\n}(this, function (exports) { 'use strict';\n\n  var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n  function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n  var Speedball = function () {\n    function Speedball() {\n      _classCallCheck(this, Speedball);\n\n      this._factories = {};\n    }\n\n    _createClass(Speedball, [{\n      key: 'register',\n      value: function register(name, factory) {\n        if (name in this._factories) {\n          throw new Error('An entity is already registered with the name \"' + name + '\"');\n        }\n\n        this._factories[name] = factory;\n\n        return this;\n      }\n    }, {\n      key: 'resolve',\n      value: function resolve(name) {\n        var resolvingSession = new ResolvingSession(this._factories);\n        var entity = new Resolver(this._factories, [], resolvingSession).resolve(name);\n\n        resolvingSession.runAfterHooks();\n\n        return entity;\n      }\n    }]);\n\n    return Speedball;\n  }();\n\n  var ResolvingSession = function () {\n    function ResolvingSession(factories) {\n      _classCallCheck(this, ResolvingSession);\n\n      this._factories = factories;\n      this._afterHooks = [];\n    }\n\n    _createClass(ResolvingSession, [{\n      key: 'addAfterHook',\n      value: function addAfterHook(f) {\n        this._afterHooks.push(f);\n      }\n    }, {\n      key: 'runAfterHooks',\n      value: function runAfterHooks() {\n        var _this = this;\n\n        this._afterHooks.forEach(function (after) {\n          var resolvingSession = new ResolvingSession(_this._factories);\n          var resolver = new Resolver(_this._factories, [], resolvingSession);\n\n          after(resolver);\n\n          resolvingSession.runAfterHooks();\n        });\n      }\n    }]);\n\n    return ResolvingSession;\n  }();\n\n  var Resolver = function () {\n    function Resolver(factories, ancestors, resolvingSession) {\n      _classCallCheck(this, Resolver);\n\n      this._factories = factories;\n      this._ancestors = ancestors;\n      this._resolvingSession = resolvingSession;\n\n      Object.freeze(this);\n    }\n\n    _createClass(Resolver, [{\n      key: 'resolve',\n      value: function resolve(name) {\n        if (!(name in this._factories)) {\n          throw new Error('Attempted to resolve an unregistered dependency: ' + name);\n        }\n\n        if (this.willCauseCycle(name)) {\n          throw new Error('Circular dependency detected');\n        }\n\n        var newResolver = new Resolver(this._factories, this._ancestors.concat([name]), this._resolvingSession);\n\n        return this._factories[name](newResolver);\n      }\n    }, {\n      key: 'after',\n      value: function after(f) {\n        this._resolvingSession.addAfterHook(f);\n      }\n    }, {\n      key: 'willCauseCycle',\n      value: function willCauseCycle(entityName) {\n        return this._ancestors.indexOf(entityName) !== -1;\n      }\n    }]);\n\n    return Resolver;\n  }();\n\n  function value(value) {\n    return function (resolver) {\n      return value;\n    };\n  }\n\n  function singleton(factory) {\n    var result;\n\n    return function (resolver) {\n      if (!result) {\n        result = factory(resolver);\n      }\n\n      return result;\n    };\n  }\n\n  function func(func) {\n    var entities = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n    return function (resolver) {\n      var args = entities.map(function (entityName) {\n        return resolver.resolve(entityName);\n      });\n      return func.apply(undefined, _toConsumableArray(args));\n    };\n  }\n\n  function construct(constructor) {\n    var entities = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n    return function (resolver) {\n      var args = entities.map(function (entity) {\n        return resolver.resolve(entity);\n      });\n\n      return new (Function.prototype.bind.apply(constructor, [null].concat(_toConsumableArray(args))))();\n    };\n  }\n\n  function props(factory, props) {\n    return function (resolver) {\n      var entity = factory(resolver);\n\n      var _loop = function _loop(propertyName) {\n        var entityName = props[propertyName];\n\n        if (resolver.willCauseCycle(entityName)) {\n          resolver.after(function (resolver) {\n            entity[propertyName] = resolver.resolve(entityName);\n          });\n        } else {\n          entity[propertyName] = resolver.resolve(entityName);\n        }\n      };\n\n      for (var propertyName in props) {\n        _loop(propertyName);\n      }\n\n      return entity;\n    };\n  }\n\n  exports['default'] = Speedball;\n  exports.value = value;\n  exports.singleton = singleton;\n  exports.func = func;\n  exports.construct = construct;\n  exports.props = props;\n\n\n\nexports.__esModule = true;\n\n}));"],"names":["global","factory","exports","module","define","amd","Speedball","this","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","_classCallCheck","instance","Constructor","TypeError","value","resolver","singleton","result","func","entities","arguments","undefined","args","map","entityName","resolve","apply","construct","constructor","entity","Function","prototype","bind","concat","props","_loop","propertyName","willCauseCycle","after","_createClass","defineProperties","target","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","_factories","name","Error","resolvingSession","ResolvingSession","Resolver","runAfterHooks","factories","_afterHooks","f","push","_this","forEach","ancestors","_ancestors","_resolvingSession","freeze","newResolver","addAfterHook","indexOf","__esModule"],"mappings":"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"}