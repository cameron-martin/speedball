{"version":3,"file":"speedball.min.js","sources":["../.gobble-build/02-rollup/1/speedball.js"],"sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define('speedball', ['exports'], factory) :\n  (factory((global.Speedball = global.Speedball || {})));\n}(this, function (exports) { 'use strict';\n\n  var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n  function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n  var Speedball = function () {\n    function Speedball() {\n      _classCallCheck(this, Speedball);\n\n      this._factories = {};\n    }\n\n    _createClass(Speedball, [{\n      key: 'register',\n      value: function register(name, factory) {\n        if (name in this._factories) {\n          throw new Error('An entity is already registered with the name \"' + name + '\"');\n        }\n\n        this._factories[name] = factory;\n\n        return this;\n      }\n    }, {\n      key: 'resolve',\n      value: function resolve(name) {\n        var resolvingSession = new ResolvingSession(this._factories);\n        var entity = new Resolver(this._factories, [], resolvingSession).resolve(name);\n\n        resolvingSession.runAfterHooks();\n\n        return entity;\n      }\n    }]);\n\n    return Speedball;\n  }();\n\n  var ResolvingSession = function () {\n    function ResolvingSession(factories) {\n      _classCallCheck(this, ResolvingSession);\n\n      this._factories = factories;\n      this._afterHooks = [];\n    }\n\n    _createClass(ResolvingSession, [{\n      key: 'addAfterHook',\n      value: function addAfterHook(f) {\n        this._afterHooks.push(f);\n      }\n    }, {\n      key: 'runAfterHooks',\n      value: function runAfterHooks() {\n        var _this = this;\n\n        this._afterHooks.forEach(function (after) {\n          var resolvingSession = new ResolvingSession(_this._factories);\n          var resolver = new Resolver(_this._factories, [], resolvingSession);\n\n          after(resolver);\n\n          resolvingSession.runAfterHooks();\n        });\n      }\n    }]);\n\n    return ResolvingSession;\n  }();\n\n  var Resolver = function () {\n    function Resolver(factories, ancestors, resolvingSession) {\n      _classCallCheck(this, Resolver);\n\n      this._factories = factories;\n      this._ancestors = ancestors;\n      this._resolvingSession = resolvingSession;\n\n      Object.freeze(this);\n    }\n\n    _createClass(Resolver, [{\n      key: 'resolve',\n      value: function resolve(name) {\n        if (!(name in this._factories)) {\n          throw new Error('Attempted to resolve an unregistered dependency: ' + name);\n        }\n\n        if (this.willCauseCycle(name)) {\n          throw new Error('Circular dependency detected');\n        }\n\n        var newResolver = new Resolver(this._factories, this._ancestors.concat([name]), this._resolvingSession);\n\n        return this._factories[name](newResolver);\n      }\n    }, {\n      key: 'after',\n      value: function after(f) {\n        this._resolvingSession.addAfterHook(f);\n      }\n    }, {\n      key: 'willCauseCycle',\n      value: function willCauseCycle(entityName) {\n        return this._ancestors.indexOf(entityName) !== -1;\n      }\n    }]);\n\n    return Resolver;\n  }();\n\n  function value(value) {\n    return function (resolver) {\n      return value;\n    };\n  }\n\n  function singleton(factory) {\n    var result;\n\n    return function (resolver) {\n      if (!result) {\n        result = factory(resolver);\n      }\n\n      return result;\n    };\n  }\n\n  function func(func) {\n    var entities = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n    return function (resolver) {\n      var args = entities.map(function (entityName) {\n        return resolver.resolve(entityName);\n      });\n      return func.apply(undefined, _toConsumableArray(args));\n    };\n  }\n\n  function construct(constructor) {\n    var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n    var argEntities = options.args || [];\n    var propEntities = options.props || {};\n\n    return function (resolver) {\n      var args = argEntities.map(function (argEntity) {\n        return resolver.resolve(argEntity);\n      });\n\n      var object = new (Function.prototype.bind.apply(constructor, [null].concat(_toConsumableArray(args))))();\n\n      var _loop = function _loop(propertyName) {\n        var entityName = propEntities[propertyName];\n\n        if (resolver.willCauseCycle(entityName)) {\n          resolver.after(function (resolver) {\n            object[propertyName] = resolver.resolve(entityName);\n          });\n        } else {\n          object[propertyName] = resolver.resolve(entityName);\n        }\n      };\n\n      for (var propertyName in propEntities) {\n        _loop(propertyName);\n      }\n\n      return object;\n    };\n  }\n\n  var __esModule = true;\n\n  exports['default'] = Speedball;\n  exports.value = value;\n  exports.singleton = singleton;\n  exports.func = func;\n  exports.construct = construct;\n  exports.__esModule = __esModule;\n\n}));"],"names":["global","factory","exports","module","define","amd","Speedball","this","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","_classCallCheck","instance","Constructor","TypeError","value","resolver","singleton","result","func","entities","arguments","undefined","args","map","entityName","resolve","apply","construct","constructor","options","argEntities","propEntities","props","argEntity","object","Function","prototype","bind","concat","_loop","propertyName","willCauseCycle","after","_createClass","defineProperties","target","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","_factories","name","Error","resolvingSession","ResolvingSession","entity","Resolver","runAfterHooks","factories","_afterHooks","f","push","_this","forEach","ancestors","_ancestors","_resolvingSession","freeze","newResolver","addAfterHook","indexOf","__esModule"],"mappings":"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"}