{"version":3,"file":"speedball.min.js","sources":["../.gobble-build/03-addEsModule/1/speedball.js"],"sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define('speedball', ['exports'], factory) :\n  (factory((global.Speedball = global.Speedball || {})));\n}(this, function (exports) { 'use strict';\n\n  var Speedball = function () {\n    function Speedball() {\n      babelHelpers.classCallCheck(this, Speedball);\n\n      this._factories = {};\n    }\n\n    babelHelpers.createClass(Speedball, [{\n      key: 'register',\n      value: function register(name, factory) {\n        if (name in this._factories) {\n          throw new Error('An entity is already registered with the name \"' + name + '\"');\n        }\n\n        this._factories[name] = factory;\n\n        return this;\n      }\n    }, {\n      key: 'resolve',\n      value: function resolve(name) {\n        var resolvingSession = new ResolvingSession(this._factories);\n        var entity = new Resolver(this._factories, [], resolvingSession).resolve(name);\n\n        resolvingSession.runAfterHooks();\n\n        return entity;\n      }\n    }]);\n    return Speedball;\n  }();\n\n  var ResolvingSession = function () {\n    function ResolvingSession(factories) {\n      babelHelpers.classCallCheck(this, ResolvingSession);\n\n      this._factories = factories;\n      this._afterHooks = [];\n    }\n\n    babelHelpers.createClass(ResolvingSession, [{\n      key: 'addAfterHook',\n      value: function addAfterHook(f) {\n        this._afterHooks.push(f);\n      }\n    }, {\n      key: 'runAfterHooks',\n      value: function runAfterHooks() {\n        var _this = this;\n\n        this._afterHooks.forEach(function (after) {\n          var resolvingSession = new ResolvingSession(_this._factories);\n          var resolver = new Resolver(_this._factories, [], resolvingSession);\n\n          after(resolver);\n\n          resolvingSession.runAfterHooks();\n        });\n      }\n    }]);\n    return ResolvingSession;\n  }();\n\n  var Resolver = function () {\n    function Resolver(factories, ancestors, resolvingSession) {\n      babelHelpers.classCallCheck(this, Resolver);\n\n      this._factories = factories;\n      this._ancestors = ancestors;\n      this._resolvingSession = resolvingSession;\n\n      Object.freeze(this);\n    }\n\n    babelHelpers.createClass(Resolver, [{\n      key: 'resolve',\n      value: function resolve(name) {\n        if (!(name in this._factories)) {\n          throw new Error('Attempted to resolve an unregistered dependency: ' + name);\n        }\n\n        if (this.willCauseCycle(name)) {\n          throw new Error('Circular dependency detected');\n        }\n\n        var newResolver = new Resolver(this._factories, this._ancestors.concat([name]), this._resolvingSession);\n\n        return this._factories[name](newResolver);\n      }\n    }, {\n      key: 'after',\n      value: function after(f) {\n        this._resolvingSession.addAfterHook(f);\n      }\n    }, {\n      key: 'willCauseCycle',\n      value: function willCauseCycle(entityName) {\n        return this._ancestors.indexOf(entityName) !== -1;\n      }\n    }]);\n    return Resolver;\n  }();\n\n  function value(value) {\n    return function (resolver) {\n      return value;\n    };\n  }\n\n  function singleton(factory) {\n    var result;\n\n    return function (resolver) {\n      if (!result) {\n        result = factory(resolver);\n      }\n\n      return result;\n    };\n  }\n\n  function func(func) {\n    var entities = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n    return function (resolver) {\n      var args = entities.map(function (entityName) {\n        return resolver.resolve(entityName);\n      });\n      return func.apply(undefined, babelHelpers.toConsumableArray(args));\n    };\n  }\n\n  function construct(constructor) {\n    var entities = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n    return function (resolver) {\n      var args = entities.map(function (entity) {\n        return resolver.resolve(entity);\n      });\n\n      return new (Function.prototype.bind.apply(constructor, [null].concat(babelHelpers.toConsumableArray(args))))();\n    };\n  }\n\n  function props(factory, props) {\n    return function (resolver) {\n      var entity = factory(resolver);\n\n      var _loop = function _loop(propertyName) {\n        var entityName = props[propertyName];\n\n        if (resolver.willCauseCycle(entityName)) {\n          resolver.after(function (resolver) {\n            entity[propertyName] = resolver.resolve(entityName);\n          });\n        } else {\n          entity[propertyName] = resolver.resolve(entityName);\n        }\n      };\n\n      for (var propertyName in props) {\n        _loop(propertyName);\n      }\n\n      return entity;\n    };\n  }\n\n  exports['default'] = Speedball;\n  exports.value = value;\n  exports.singleton = singleton;\n  exports.func = func;\n  exports.construct = construct;\n  exports.props = props;\n\n\n\nexports.__esModule = true;\n\n}));"],"names":["global","factory","exports","module","define","amd","Speedball","this","value","resolver","singleton","result","func","entities","arguments","length","undefined","args","map","entityName","resolve","apply","babelHelpers","toConsumableArray","construct","constructor","entity","Function","prototype","bind","concat","props","_loop","propertyName","willCauseCycle","after","classCallCheck","_factories","createClass","key","name","Error","resolvingSession","ResolvingSession","Resolver","runAfterHooks","factories","_afterHooks","f","push","_this","forEach","ancestors","_ancestors","_resolvingSession","Object","freeze","newResolver","addAfterHook","indexOf","__esModule"],"mappings":"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"}